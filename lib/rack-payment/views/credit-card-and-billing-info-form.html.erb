<%
  # TODO use helper for select options for credit card type
  # TODO use helper for select options for expiration
%>

<div class='rack-payment'>
  <% if errors and not errors.empty? %>
    <div class='errors'>
      <p>There were problems processing your request:</p>
      <ul class='errors'>
        <% for error in errors %>
          <li><%= error %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <form action='<%= post_to %>' method='post'>

    <fieldset>
      <legend>Credit Card</legend>

      <div class='group'>
        <label for='credit_card_first_name'>First Name</label>
        <input type='text' id='credit_card_first_name' name='credit_card[first_name]' value='<%= credit_card.first_name %>' autofocus='true' />

        <label for='credit_card_last_name'>Last Name</label>
        <input type='text' id='credit_card_last_name' name='credit_card[last_name]' value='<%= credit_card.last_name %>' />

        <label for='credit_card_number'>Card Number</label>
        <input type='text' id='credit_card_number' name='credit_card[number]' value='<%= credit_card.number %>' />
      </div>

      <div class='group'>
        <label for='credit_card_type'>Card Type</label>
        <select id='credit_card_type' name='credit_card[type]' />
          <%= options_for_credit_card_type credit_card.type %>
          <%= [ ['visa', 'Visa'], ['master', 'MasterCard'], ['american_express', 'American Express'], ['discover', 'Discover'] ].
            map {|value, name| 
              selected = credit_card.type == value ? " selected='selected'" : nil
              "<option value='#{ value }'#{ selected }'>#{ name }</option>" }
          %>
        </select>

        <label for='credit_card_cvv'>CVV</label>
        <input type='text' id='credit_card_cvv' name='credit_card[cvv]' value='<%= credit_card.cvv %>' />

        <label for='credit_card_expiration_month'>Expiration</label>
        <select id='credit_card_expiration_month' name='credit_card[expiration_month]'>
          <%= options_for_expiration_month credit_card.month %>
        </select>
        <select id='credit_card_expiration_year' name='credit_card[expiration_year]'>
          <%= options_for_expiration_year credit_card.year %>
        </select>

      </div>
    </fieldset>

    <fieldset>
      <legend>Billing Address</legend>

      <div class='group'>
        <% %w( name address1 city ).each do |field| %>
          <label for='credit_card_<%= field %>'><%= field.gsub('_', ' ').capitalize %></label>
          <input type='text' id='billing_address_<%= field %>' name='billing_address[<%= field %>]' value='<%= billing_address[field] %>' />
        <% end %>
      </div>

      <div class='group'>
        <% %w( state country zip ).each do |field| %>
          <label for='credit_card_<%= field %>'><%= field.gsub('_', ' ').capitalize %></label>
          <input type='text' id='billing_address_<%= field %>' name='billing_address[<%= field %>]' value='<%= billing_address[field] %>' />
        <% end %>
      </div>
    </fieldset>

    <div id='complete_purchase'>
      <input type='submit' value='Complete Purchase' />
    </div>

  </form>
</div>
