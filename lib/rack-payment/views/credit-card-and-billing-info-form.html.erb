<div class='rack-payment'>

  <h1>Credit Card and Billing Info</h1>

  <% if @errors and not @errors.empty? %>
    <div class='errors'>
      <p>There were problems processing your request:</p>
      <ul class='errors'>
        <% for error in @errors %>
          <li><%= error %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <form action='<%= @this.built_in_form_path %>' method='post'>

    <!-- required?  try getting rid of it -->
    <input type='hidden' name='rack.payment' value='true' />

    <fieldset>
      <legend>Credit Card</legend>

      <div class='group'>
      <% %w( first_name last_name number type ).each do |field| %>
        <label>
          <%= field.gsub('_', ' ').capitalize %>
          <input type='text' name='credit_card_<%= field %>' value='<%= @params["credit_card_#{ field }"] %>' />
        </label>
      <% end %>
      </div>

      <div class='group'>
      <% %w( cvv expiration_month expiration_year ).each do |field| %>
        <label>
          <%= field.gsub('_', ' ').capitalize %>
          <input type='text' name='credit_card_<%= field %>' value='<%= @params["credit_card_#{ field }"] %>' />
        </label>
      <% end %>
      </div>
    </fieldset>

    <fieldset>
      <legend>Billing Address</legend>

      <div class='group'>
      <% %w( name address1 city ).each do |field| %>
        <label>
          <%= field.gsub('_', ' ').capitalize %>
          <input type='text' name='billing_address_<%= field %>' value='<%= @params["billing_address_#{ field }"] %>' />
        </label>
      <% end %>
      </div>

      <div class='group'>
      <% %w( state country zip ).each do |field| %>
        <label>
          <%= field.gsub('_', ' ').capitalize %>
          <input type='text' name='billing_address_<%= field %>' value='<%= @params["billing_address_#{ field }"] %>' />
        </label>
      <% end %>
      </div>
    </fieldset>

    <input type='submit' value='Purchase' />

  </form>

</div>
